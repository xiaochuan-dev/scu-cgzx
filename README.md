# http://cgzx.scu.edu.cn/venue预约

# 使用说明

> 下面的使用说明是抢每天早上`10:00-12:00`的华西校区网球场的

## 环境准备

使用任意电脑的任意浏览器操作

## 开始操作

在正式放号抢之前5分钟完成登录

### 进去浏览器打开调试工具

进入浏览器按`F12`或者右键点击检查打开调试工具，并在调试窗口中找到`console`或者`控制台`。这里用windows下的chrome来操作

![](https://unpkg.luckincdn.com/@xiaochuan-dev/static@0.0.38/dist/ce6f46ddfe59cfd7.png)

### 登陆页面操作

在刚才打开了调试工具的页面进入登陆页面，网页链接是`http://cgzx.scu.edu.cn/venue`  把下面的代码复制到`console`中按回车执行

```js
;(() => {
  const ele = document.querySelector('.register > uni-image');
  ele.remove();
})();
```

这时就能看到登陆框了，按正常操作登陆

![](https://unpkg.luckincdn.com/@xiaochuan-dev/static@0.0.38/dist/72633ff1e599298c.png)

## 抢场地

这时已经登录到了首页

复制下面的代码到`console`里面先不要按回车，在开始抢之前2分钟按回车执行抢

```js
!function(){"use strict";async function t(t,e){return new Promise((n=>{const s=document.createElement("script");s.src=t,s.onload=()=>{e?.(),n(!0)},document.head.appendChild(s)}))}function e(t){return t.split("").reverse().join("")}function n(){this.mode=1,this.isPadding=!0,this.sk=new Array(32)}function s(){this.SM4_ENCRYPT=1,this.SM4_DECRYPT=0;var t=[214,144,233,254,204,225,61,183,22,182,20,194,40,251,44,5,43,103,154,118,42,190,4,195,170,68,19,38,73,134,6,153,156,66,80,244,145,239,152,122,51,84,11,67,237,207,172,98,228,179,28,169,201,8,232,149,128,223,148,250,117,143,63,166,71,7,167,252,243,115,23,186,131,89,60,25,230,133,79,168,104,107,129,178,113,100,218,139,248,235,15,75,112,86,157,53,30,36,14,94,99,88,209,162,37,34,124,59,1,33,120,135,212,0,70,87,159,211,39,82,76,54,2,231,160,196,200,158,234,191,138,210,64,199,56,181,163,247,242,206,249,97,21,161,224,174,93,164,155,52,26,85,173,147,50,48,245,140,177,227,29,246,226,46,130,102,202,96,192,41,35,171,13,83,78,111,213,219,55,69,222,253,142,47,3,255,106,114,109,108,91,81,141,27,175,146,187,221,188,127,17,217,92,65,31,16,90,216,10,193,49,136,165,205,123,189,45,116,208,18,184,229,180,176,137,105,151,74,12,150,119,126,101,185,241,9,197,110,198,132,24,240,125,236,58,220,77,32,121,238,95,62,215,203,57,72],e=[2746333894,1453994832,1736282519,2993693404],n=[462357,472066609,943670861,1415275113,1886879365,2358483617,2830087869,3301692121,3773296373,4228057617,404694573,876298825,1347903077,1819507329,2291111581,2762715833,3234320085,3705924337,4177462797,337322537,808926789,1280531041,1752135293,2223739545,2695343797,3166948049,3638552301,4110090761,269950501,741554753,1213159005,1684763257];this.GET_ULONG_BE=function(t,e){return(255&t[e])<<24|(255&t[e+1])<<16|(255&t[e+2])<<8|255&t[e+3]},this.PUT_ULONG_BE=function(t,e,n){var s=255&t>>24,r=255&t>>16,i=255&t>>8,a=255&t;e[n]=s>128?s-256:s,e[n+1]=r>128?r-256:r,e[n+2]=i>128?i-256:i,e[n+3]=a>128?a-256:a},this.SHL=function(t,e){return(4294967295&t)<<e},this.ROTL=function(t,e){return this.SHL(t,e),this.SHL(t,e)|t>>32-e},this.sm4Lt=function(t){var e,n=new Array(4),s=new Array(4);return this.PUT_ULONG_BE(t,n,0),s[0]=this.sm4Sbox(n[0]),s[1]=this.sm4Sbox(n[1]),s[2]=this.sm4Sbox(n[2]),s[3]=this.sm4Sbox(n[3]),(e=this.GET_ULONG_BE(s,0))^this.ROTL(e,2)^this.ROTL(e,10)^this.ROTL(e,18)^this.ROTL(e,24)},this.sm4F=function(t,e,n,s,r){return t^this.sm4Lt(e^n^s^r)},this.sm4CalciRK=function(t){var e,n=new Array(4),s=new Array(4);return this.PUT_ULONG_BE(t,n,0),s[0]=this.sm4Sbox(n[0]),s[1]=this.sm4Sbox(n[1]),s[2]=this.sm4Sbox(n[2]),s[3]=this.sm4Sbox(n[3]),(e=this.GET_ULONG_BE(s,0))^this.ROTL(e,13)^this.ROTL(e,23)},this.sm4Sbox=function(e){var n=t[255&e];return n>128?n-256:n},this.sm4_setkey_enc=function(t,e){return null==t?(alert("ctx is null!"),!1):null==e||16!==e.length?(alert("key error!"),!1):(t.mode=this.SM4_ENCRYPT,void this.sm4_setkey(t.sk,e))},this.sm4_setkey_dec=function(t,e){null!=e&&16===e.length||Error("key error!"),t.mode=this.SM4_DECRYPT,this.sm4_setkey(t.sk,e),t.sk=t.sk.reverse()},this.sm4_setkey=function(t,s){var r=new Array(4),i=new Array(36);r[0]=this.GET_ULONG_BE(s,0),r[1]=this.GET_ULONG_BE(s,4),r[2]=this.GET_ULONG_BE(s,8),r[3]=this.GET_ULONG_BE(s,12),i[0]=r[0]^e[0],i[1]=r[1]^e[1],i[2]=r[2]^e[2],i[3]=r[3]^e[3];for(var a=0;a<32;a++)i[a+4]=i[a]^this.sm4CalciRK(i[a+1]^i[a+2]^i[a+3]^n[a]),t[a]=i[a+4]},this.padding=function(t,e){if(null==t)return null;var n=null;if(e===this.SM4_ENCRYPT){var s=parseInt(16-t.length%16);n=t.slice(0);for(var r=0;r<s;r++)n[t.length+r]=s}else{var i=t[t.length-1];n=t.slice(0,t.length-i)}return n},this.sm4_one_round=function(t,e,n){var s=0,r=new Array(36);for(r[0]=this.GET_ULONG_BE(e,0),r[1]=this.GET_ULONG_BE(e,4),r[2]=this.GET_ULONG_BE(e,8),r[3]=this.GET_ULONG_BE(e,12);s<32;)r[s+4]=this.sm4F(r[s],r[s+1],r[s+2],r[s+3],t[s]),s++;this.PUT_ULONG_BE(r[35],n,0),this.PUT_ULONG_BE(r[34],n,4),this.PUT_ULONG_BE(r[33],n,8),this.PUT_ULONG_BE(r[32],n,12)},this.sm4_crypt_ecb=function(t,e){null==e&&alert("input is null!"),t.isPadding&&t.mode===this.SM4_ENCRYPT&&(e=this.padding(e,this.SM4_ENCRYPT));for(var n=0,s=e.length,r=new Array;s>0;s-=16){var i=new Array(16),a=e.slice(16*n,16*(n+1));this.sm4_one_round(t.sk,a,i),r=r.concat(i),n++}var o=r;t.isPadding&&t.mode===this.SM4_DECRYPT&&(o=this.padding(o,this.SM4_DECRYPT));for(var c=0;c<o.length;c++)o[c]<0&&(o[c]=o[c]+256);return o},this.sm4_crypt_cbc=function(t,e,n){null!=e&&16===e.length||alert("iv error!"),null==n&&alert("input is null!"),t.isPadding&&t.mode===this.SM4_ENCRYPT&&(n=this.padding(n,this.SM4_ENCRYPT));var s=0,r=n.length,i=new Array;if(t.mode===this.SM4_ENCRYPT)for(var a=0;r>0;r-=16){var o=new Array(16),c=new Array(16),d=n.slice(16*a,16*(a+1));for(s=0;s<16;s++)o[s]=d[s]^e[s];this.sm4_one_round(t.sk,o,c),e=c.slice(0,16),i=i.concat(c),a++}else for(var h=[],u=0;r>0;r-=16){var l=new Array(16),m=new Array(16),f=n.slice(16*u,16*(u+1));for(h=f.slice(0,16),this.sm4_one_round(t.sk,f,l),s=0;s<16;s++)m[s]=l[s]^e[s];e=h.slice(0,16),i=i.concat(m),u++}var _=i;t.isPadding&&t.mode===this.SM4_DECRYPT&&(_=this.padding(_,this.SM4_DECRYPT));for(var p=0;p<_.length;p++)_[p]<0&&(_[p]=_[p]+256);return _}}function r(){this.secretKey=e("Hw9U8FeJ")+e("8Y2sfMOF"),this.iv="",this.encryptData_ECB=function(e){try{var r=new s,i=new n;i.isPadding=!0,i.mode=r.SM4_ENCRYPT;var a=t(this.secretKey);r.sm4_setkey_enc(i,a);var o=r.sm4_crypt_ecb(i,t(e)),c=window.base64js.fromByteArray(o);return null!=c&&c.trim().length>0&&c.replace(/(\s*|\t|\r|\n)/g,""),c}catch(t){return console.error(t),null}},this.decryptData_ECB=function(e){try{var r=new s,i=new n;i.isPadding=!0,i.mode=r.SM4_DECRYPT;var a=t(this.secretKey);return r.sm4_setkey_dec(i,a),function(t){for(var e="",n=0;n<t.length;){var s=t[n],r=0;s>>>7==0?(e+=String.fromCharCode(t[n]),n+=1):252&~s?248&~s?240&~s?224&~s?192&~s?(e+=String.fromCharCode(t[n]),n+=1):(r=(63&t[n])<<6,r|=63&t[n+1],e+=String.fromCharCode(r),n+=2):(r=(31&t[n])<<12,r|=(63&t[n+1])<<6,r|=63&t[n+2],e+=String.fromCharCode(r),n+=3):(r=(15&t[n])<<18,r|=(63&t[n+1])<<12,r|=(63&t[n+2])<<6,r|=63&t[n+3],e+=String.fromCharCode(r),n+=4):(r=(7&t[n])<<24,r|=(63&t[n+1])<<18,r|=(63&t[n+2])<<12,r|=(63&t[n+3])<<6,r|=63&t[n+4],e+=String.fromCharCode(r),n+=5):(r=(3&t[n])<<30,r|=(63&t[n+1])<<24,r|=(63&t[n+2])<<18,r|=(63&t[n+3])<<12,r|=(63&t[n+4])<<6,r|=63&t[n+5],e+=String.fromCharCode(r),n+=6)}return e}(r.sm4_crypt_ecb(i,window.base64js.toByteArray(e)))}catch(t){return console.log(t),console.error(t),null}},this.encryptData_CBC=function(e){try{var r=new s,i=new n;i.isPadding=!0,i.mode=r.SM4_ENCRYPT;var a=t(this.secretKey),o=t(this.iv);r.sm4_setkey_enc(i,a);var c=r.sm4_crypt_cbc(i,o,t(e)),d=window.base64js.fromByteArray(c);return null!=d&&d.trim().length>0&&d.replace(/(\s*|\t|\r|\n)/g,""),d}catch(t){return console.error(t),null}};var t=function(t){var e,n,s=new Array;e=t.length;for(var r=0;r<e;r++)(n=t.charCodeAt(r))>=65536&&n<=1114111?(s.push(n>>18&7|240),s.push(n>>12&63|128),s.push(n>>6&63|128),s.push(63&n|128)):n>=2048&&n<=65535?(s.push(n>>12&15|224),s.push(n>>6&63|128),s.push(63&n|128)):n>=128&&n<=2047?(s.push(n>>6&31|192),s.push(63&n|128)):s.push(255&n);return s}}function i(t){return(new r).decryptData_ECB(t)}function a(t){const e=JSON.stringify(t||{});var n;var s;return{sign:(n=e,window.sm2.doSignature(n,"58967e2beb6fffd3c96545eebd3000b39c10087d48faa0d41f9c7bf3720e0ea4",{hash:!0,der:!0})),data:(s=e,(new r).encryptData_ECB(s))}}const o=new class{defaultHeaders={Authorization:localStorage.getItem("accessToken"),"tenant-id":"1",terminal:"10","X-Timestamp":`${Date.now()}`,"User-Agent":"mozilla/5.0 (linux; android 5.1.1; mi note pro build/lmy47v) applewebkit/537.36 (khtml, like gecko) version/4.0 chrome/37.0.0.0 mobile mqqbrowser/6.2 tbs/036215 safari/537.36 micromessenger/6.3.16.49_r03ae324.780 nettype/wifi language/zh_cn"};baseUrl="http://cgzx.scu.edu.cn";constructor(){}async get({path:t,params:e}){const n=e??{},{sign:s,data:r}=a(n),o=new URLSearchParams({sign:s,data:r}).toString(),c=await fetch(`${this.baseUrl}${t}?${o}`,{method:"GET",headers:{...this.defaultHeaders}}),d=i((await c.json()).data),h=JSON.parse(d);return JSON.parse(h).data}async post({path:t,data:e}){const{sign:n,data:s}=a(e),r=await fetch(`${this.baseUrl}${t}`,{method:"POST",body:JSON.stringify({data:s,sign:n}),headers:{...this.defaultHeaders,"Content-Type":"application/json"}}),o=i((await r.json()).data),c=JSON.parse(o);return JSON.parse(c).data}};async function c(t){const e=`/app-api/venue/field/get-bookable-times/${t.id}`;return await o.get({path:e})}function d(t,e,n,s){const r="HH:mm",i=window.dayjs(t,r),a=window.dayjs(e,r),o=window.dayjs(n,r),c=window.dayjs(s,r);return i.isSameOrAfter(o)&&a.isSameOrBefore(c)}function h(){const{data:t}=JSON.parse(localStorage.getItem("userInfo"));return t.userId}async function u({venueId:t,field:e,callback:n}){const s={userId:h(),couponId:"",venueId:t,bookings:[e]},r=await async function(t){const e=await o.post({path:"/app-api/venue/booking/orders/create",data:t});return e?.orderNo}(s);n(!!r)}async function l({bookingDate:t,venueId:e,needStartTime:n,needEndTime:s,frequency:r}){let i=0;const{fields:a}=await async function(t){return await o.get({path:"/app-api/venue/venue/info",params:t})}({id:e}),h=a.map((t=>t.id)),l=setInterval((async()=>{let r=null;for(const i of h){const a=await c({id:i}),o=a.find((e=>e.date===t))?.timeSlots;if(o){for(const a of o){const{startTime:o,endTime:c,bookable:h}=a;if(h&&d(o,c,n,s)){r={fieldId:i,startTime:o,endTime:c,venueId:e,bookingDate:t},console.log("找到可用时间段");break}}if(r)break}else console.log("没有找到当天的可预约时间")}r?await u({venueId:e,field:r,callback:t=>{t?(console.log("成功下单，请去订单页面查看"),clearInterval(l)):(i+=1,console.log(`下单失败，第${i}次下单`))}}):console.log(`没有找到符合的场地和时间，第${++i}次抢`)}),r)}(async()=>{await async function(){await t("https://unpkg.luckincdn.com/base64-js@1.5.1/base64js.min.js"),await t("https://unpkg.luckincdn.com/sm-crypto@0.3.13/dist/sm2.js"),await t("https://unpkg.luckincdn.com/dayjs@1.11.13/dayjs.min.js"),await t("https://unpkg.luckincdn.com/dayjs@1.11.13/plugin/customParseFormat.js",(()=>{window.dayjs.extend(window.dayjs_plugin_customParseFormat)})),await t("https://unpkg.luckincdn.com/dayjs@1.11.13/plugin/isSameOrAfter.js",(()=>{window.dayjs.extend(window.dayjs_plugin_isSameOrAfter)})),await t("https://unpkg.luckincdn.com/dayjs@1.11.13/plugin/isSameOrBefore.js",(()=>{window.dayjs.extend(window.dayjs_plugin_isSameOrBefore)}))}(),await l({bookingDate:window.dayjs().format("YYYY-MM-DD"),venueId:"10",needStartTime:"10:00",needEndTime:"12:00",frequency:500})})()}();
```

注意看控制台中的输出
